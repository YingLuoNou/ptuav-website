---
import Layout from "../layouts/Layout.astro";
import HeroSection from "@/components/HeroSection";
import { Features } from "@/components/Features";
import { Cases } from "@/components/Cases";
import { Partners } from "@/components/Partners";

// --- 修改部分 START ---
import { getCollection } from 'astro:content';

// 1. 获取产品数据 
const allProducts = await getCollection('products');
const featuredProducts = allProducts
  .filter((item) => item.data.feature === true)
  .sort((a, b) => a.data.order - b.data.order)
  .map((item) => ({
    title: item.data.title,
    description: item.data.description,
    image: item.data.image,
    url: `/products/${item.id}`,
    id: item.id 
  }));

// 2. 获取案例数据逻辑
const allCases = await getCollection('cases');
const featuredCases = allCases
  // 筛选：必须包含 cases: true 字段
  .filter((item) => item.data.cases === true) 
  // 排序：按 order 从小到大
  .sort((a, b) => a.data.order - b.data.order)
  // 映射：转换为组件需要的格式
  .map((item) => ({
    title: item.data.title,
    category: item.data.category,
    description: item.data.description,
    image: item.data.image,
    url: `/cases/${item.id}`
  }));
---

<Layout title="Phoenixtech - 翎霄科技">
  <main class="w-full min-h-screen bg-white dark:bg-black transition-colors">
    <HeroSection client:load />
    
    {/* 这里的 Features 组件也需要微调以支持 id 字段，见下一步 */}
    <Features client:load products={featuredProducts} />
    
    <Cases client:load items={featuredCases} />
    <Partners client:load />
  </main>
</Layout>