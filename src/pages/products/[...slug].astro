---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
// 1. 引入导航栏组件
import { Navbar } from "@/components/Navbar";

export async function getStaticPaths() {
  const products = await getCollection('products');
  return products.map(product => ({
    params: { slug: product.id },
    props: { product },
  }));
}

// Ensure product is typed correctly and not never
const { product } = Astro.props as { product: any };
const { Content } = await render(product);
---

<Layout title={product.data.title}>
  
  {/* 2. 在这里放置导航栏，并开启 client:load 以支持交互（如滚动变色） */}
  <Navbar client:load />

  <article class="min-h-screen bg-black pt-32 pb-20 px-6">
    <div class="max-w-4xl mx-auto">

      {/* 产品大图 */}
      <div class="relative w-full h-[400px] mb-10 rounded-2xl overflow-hidden border border-white/10">
        <img 
          src={product.data.image} 
          alt={product.data.title} 
          class="w-full h-full object-cover"
          /* 如果您后续想加回动画，可以保留这个 transition:name，否则它没有任何副作用 */
          transition:name={`image-${product.id}`} 
        />
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
      </div>

      {/* 标题 */}
      <h1 
        class="text-4xl md:text-6xl font-bold text-white mb-6 tracking-tight"
        transition:name={`title-${product.id}`}
      >
        {product.data.title}
      </h1>

      {/* 描述 */}
      <p class="text-xl text-neutral-400 mb-10 border-l-4 border-blue-500 pl-4">
        {product.data.description}
      </p>

      {/* Markdown 正文 */}
      <div class="prose prose-invert prose-lg max-w-none text-neutral-300">
        <Content />
      </div>

    </div>
  </article>
</Layout>